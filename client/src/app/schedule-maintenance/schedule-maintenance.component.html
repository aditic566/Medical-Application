
<div class="main-container">
  <nav class="nav-section">
    <button class="back-btn" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Back
    </button>

    <h2 class="nav-title">SCHEDULE MAINTENANCE</h2>
  </nav>

  <div class="form-card">
    <form [formGroup]="itemForm" (ngSubmit)="onSubmit()">
      <div class="form-grid">
        <!-- Hospital & Equipment Selection -->
        <div class="form-row">
          <div class="form-group">
            <label for="hospitalId">Hospital<span style="color: red;">*</span></label>
            <select id="hospitalId" formControlName="hospitalId" (change)="onHospitalSelect($event)" class="form-control">
              <option value="" disabled [selected]="true">Select Hospital</option>
              <option *ngFor="let hospital of hospitalList" [value]="hospital.id">{{ hospital.name }}</option>
            </select>
            <div class="error-message" *ngIf="itemForm.get('hospitalId')?.invalid && itemForm.get('hospitalId')?.touched">
              Hospital is required
            </div>
          </div>

          <div class="form-group">
            <label for="equipmentId">Equipment<span style="color: red;">*</span></label>
            <select id="equipmentId" formControlName="equipmentId" class="form-control">
              <option value="" disabled [selected]="true">Select Equipment</option>
              <option *ngFor="let equipment of equipmentList" [value]="equipment.id">{{ equipment.name }}</option>
            </select>
            <div class="error-message" *ngIf="itemForm.get('equipmentId')?.invalid && itemForm.get('equipmentId')?.touched">
              Equipment is required
            </div>
          </div>
        </div>

        <!-- Dates Selection -->
        <div class="form-row">
          <div class="form-group">
            <label for="scheduledDate">Scheduled Date<span style="color: red;">*</span></label>
            <input type="date" id="scheduledDate" formControlName="scheduledDate" class="form-control" [min]="currentDate" (change)="updateCompletedDateMin()">
            <div class="error-message" *ngIf="itemForm.get('scheduledDate')?.invalid && itemForm.get('scheduledDate')?.touched">
              Scheduled Date is required
            </div>
          </div>

          <div class="form-group">
            <label for="completedDate">Expected Completion Date<span style="color: red;">*</span></label>
            <input type="date" id="completedDate" formControlName="completedDate" class="form-control" [min]="completedDateMin">
            <div class="error-message" *ngIf="itemForm.get('completedDate')?.invalid && itemForm.get('completedDate')?.touched">
              Invalid date format
            </div>
          </div>
        </div>

        <!-- Description & Status -->
        <div class="form-row">
          <div class="form-group full-width">
            <label for="description">Description<span style="color: red;">*</span></label>
            <textarea id="description" formControlName="description" class="form-control" rows="3"></textarea>
            <div class="error-message" *ngIf="itemForm.get('description')?.invalid && itemForm.get('description')?.touched">
              Description is required
            </div>
          </div>
        </div>

        <!-- Submit Button & Messages -->
        <div class="button-container">
          <button type="submit" class="submit-btn" [disabled]="!itemForm.valid || isLoading">
            <span *ngIf="!isLoading">Schedule Maintenance</span>
            <div *ngIf="isLoading" class="loader"></div>
          </button>
        </div>

        <div class="message-container">
          <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
          <div *ngIf="showMessage" class="alert alert-success">{{ responseMessage }}</div>
        </div>
      </div>
    </form>
  </div>
</div>
